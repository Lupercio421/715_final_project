---
title: "NYC EMS Response times"
author: "Daniel L."
date: "3/25/2021"
output: html_document
---

```{r, error = FALSE, message=FALSE}
library(tidyverse)
library(lubridate)
```


```{r}
data_911 <- read.csv("/Users/daniel421/Desktop/R/STAT_715/911_End-to-End_Data.csv", header= TRUE)
```


```{r}
#str(data_911);
```
We see that the data is a character, so I will work on making it a POSIX

```{r}
data_911[,1] <- mdy(data_911[,1])
```


Let us Isolate the 3 major Agencies right away

#### EMS

```{r}
EMS_data <- data_911 %>% filter(Agency == "EMS")
```

```{r}
EMS_data <- EMS_data[,-c(7,8,16,17,29,30)]
```

#### NYPD

```{r}
NYPD_data <- data_911 %>% filter(Agency == "NYPD")
```

```{r}
NYPD_data <- NYPD_data[,-c(7,8,9,10,16,17,18,19,25,26,29,30)]
```

### FDNY

```{r}
FDNY_data <- data_911 %>% filter(Agency == "FDNY")
```


```{r}
#filter(MONTH >= as.Date("2017-01-01") & MONTH <= as.Date("2017-12-01"))
FDNY_data %>% filter(Final_Incident_Type == "1. Structural Fires") %>% filter(Week_Start_Date >= as.Date("2014-01-06") & Week_Start_Date <= as.Date("2014-12-29"))
```

```{r}
FDNY_data %>% filter(Final_Incident_Type == "1. Structural Fires") %>% filter(Week_Start_Date >= as.Date("2015-01-05") & Week_Start_Date <= as.Date("2015-12-28"))
```
```{r}
FDNY_data %>% filter(Final_Incident_Type == "1. Structural Fires") %>% filter(Week_Start_Date >= as.Date("2016-01-04") & Week_Start_Date <= as.Date("2016-12-26"))
```
```{r}
FDNY_data %>% filter(Final_Incident_Type == "1. Structural Fires") %>% filter(Week_Start_Date >= as.Date("2017-01-02") & Week_Start_Date <= as.Date("2017-12-25"))
```

```{r}
FDNY_data %>% filter(Final_Incident_Type == "1. Structural Fires") %>% filter(Week_Start_Date >= as.Date("2017-01-04") & Week_Start_Date <= as.Date("2019-12-30"))
```

2015 ["2015-01-05" - "2015-12-28"] -> 52

2016 ["2016-01-04" - "2016-12-26"] -> 52

2017 ["2017-01-02" - "2017-12-25"] -> 52

2018["2018-01-01" - "2018-12-24"] -> 52 week observations

2019["2018-12-31" - "2019-12-23"] -> 52 week observations

```{r}
FDNY_data %>% filter(Week_Start_Date >= as.Date("2014-01-06") & Week_Start_Date <= as.Date("2014-12-29")) 
```
# NYPD

```{r}
NYPD_data %>% filter(Week_Start_Date >= as.Date("2014-01-06") & Week_Start_Date <= as.Date("2020-08-24"))
```
Best to exclude 2013 and 2014

Let us check to see if Jan of 2015 through Dec of 2019 gives us 780 rows

2015, 2016, 2017 has 52 week observations

2018["2018-01-01" - "2018-12-24"] -> 52 week observations

2019["2018-12-31" - "2019-12-23"] -> 52 week observations


```{r}
NYPD_data %>% filter(Week_Start_Date >= as.Date("2018-12-31") & Week_Start_Date <= as.Date("2019-12-23"))
```

# EMS

2015,2016, 2017, 2018 has 52 observations for each incident type

2018["2018-01-01" - "2018-12-24"] -> 52 week observations

2019["2018-12-31" - "2019-12-30"] -> 53 week observations

2019["2019-01-07" - "2019-12-30"] -> 52 week observations

2019["2018-12-31" - "2019-12-23"] -> 52 week observations


```{r}
EMS_data %>% filter(Week_Start_Date >= as.Date("2018-12-31") & Week_Start_Date <= as.Date("2019-12-23"))
```

```{r}
EMS_data %>% filter(Week_Start_Date >= as.Date("2020-01-06") & Week_Start_Date <= as.Date("2020-08-24"))
```

# THIS 911 data will be from "2015-01-05" through "2019-12-23". The years 2015 through 2019 will have 52 weekly observations, per year.


```{r}
data_911 <- data_911 %>% filter(Week_Start_Date >= as.Date("2015-01-05") & Week_Start_Date <= as.Date("2019-12-23"))
```

Let us Isolate the 3 major Agencies again

#### EMS

```{r}
EMS_data <- data_911 %>% filter(Agency == "EMS")
```

```{r}
EMS_data <- EMS_data[,-c(7,8,16,17,29,30)]
```

#### NYPD

```{r}
NYPD_data <- data_911 %>% filter(Agency == "NYPD")
```

```{r}
NYPD_data <- NYPD_data[,-c(7,8,9,10,16,17,18,19,25,26,29,30)]
```

### FDNY

```{r}
FDNY_data <- data_911 %>% filter(Agency == "FDNY")
```

It is up to me if the start and end dates should be "2015-01-05" through "2019-12-30" or whether it should be "2015-01-05" through "2020-08-24"

```{r, message = FALSE}
library(TSA)
#load forescasting package
library(fpp2)
library(lubridate)
```

```{r}
class(EMS_data)
```

```{r}
#ts(new_EMS_data[,c(3,10)], freq = 365.25/7, start = decimal_date(ymd("2015-01-05")))
```

## EMS Part 2

```{r}
EMS_final_1 <- EMS_data %>% filter(Final_Incident_Type == "1. Life Threating Med Emergencies")
```

```{r}
ts_EMS_final_1 <- ts(EMS_final_1[,c(1,10)], freq = 365.25/7, start = ymd(EMS_final_1[1,1]))
```

